<!-- This file is part of Yeast -->
<!-- Yeast is free software: see LICENSE.txt for more details. -->

<html lang="en">
  <head>
    <meta charset="UTF-8">
    <title>Yeast - Simple reverse proxy</title>
    <style>
      .add-submit-btn,.toolbar-btn,button{border-radius:3px}body,dd,dl,dt{padding:0;margin:0}.aside,.container,body{height:100%}html{font-size:16px;color:#212121}body{font-size:100%;font-family:"Segoe UI","Lucida Grande",Helvetica,Arial,"Microsoft YaHei",FreeSans,Arimo,"Droid Sans","wenquanyi micro hei","Hiragino Sans GB","Hiragino Sans GB W3",Arial,sans-serif;min-width:320px}button{cursor:pointer;background:0 0;outline:0;border:none}button:focus{outline:0}button,button:before,input,label,textarea{transition:all .3s;font-family:'Open Sans',sans-serif}fieldset{border:0;padding:.01em 0 0;margin:0;min-width:0}body:not(:-moz-handler-blocked) fieldset{display:table-cell}label.is-conflict:after{content:'*Conflict';color:#e53935;margin-left:.5em}label.is-required:after{content:'*Required';color:#e53935;margin-left:.5em}.text-btn{color:#757575;background-color:transparent}.text-btn:hover{color:#ffc107}.container{width:100%;position:fixed;margin:auto;display:flex;flex-direction:row}.aside{border-right:1px #e0e0e0 solid;box-shadow:0 0 1px 0 #eee;max-width:300px;width:30%;min-width:250px;overflow-y:auto}.main{width:calc(100% - 2em);padding:1em;overflow:auto}.main>div{max-width:1000px}.add-wrapper{padding:1em;border:none;margin:1.5em 0 0}.add-title{font-size:1.2em}.add-title:before{content:'\2B22';margin-right:.8em}.add-row{position:relative;margin:1em 0;display:flex;flex-direction:column}.add-row label{display:block;font-size:.8em;color:#757575;margin-bottom:.5em;order:1}.add-row input{background:0 0;border:none;display:block;border-bottom:1px #e0e0e0 solid;font-size:1.5em;outline:0;padding-bottom:.3em;order:2}.add-row textarea{border:1px solid #e0e0e0;resize:vertical;min-height:60px;outline:0;padding:.5em;order:2}.add-row input:focus,.add-row textarea:focus{border-color:#ffc107;color:#ffa000}.add-row input:focus+label,.add-row textarea:focus+label{color:#ffc107}.add-submit-btn{display:block;margin:auto;width:calc(100% - 1em);padding:.6em;background-color:#ffca28;color:#FFF;text-shadow:0 -1px 1px rgba(0,0,0,.1);font-size:1em}.btn-disableAll:before,.btn-enableAll:before{margin-top:.4em;content:'';display:inline-block}.add-submit-btn:hover{background-color:#ffa000}.toolbar{padding-bottom:1em}.toolbar-btn{font-size:1em;margin-right:1em;text-shadow:0 -1px 0 rgba(0,0,0,.2);color:#fff;padding:.3em 1em .3em 2em;position:relative}.toolbar-btn:last-child{margin-right:0}.toolbar-btn:before{font-size:.8em;position:absolute;left:1.2em;margin-right:.5em}.toolbar-btn.btn-enableAll{background-color:#66bb6a}.toolbar-btn.btn-enableAll:hover{background-color:#43a047}.toolbar-btn.btn-disableAll{background-color:#e57373}.toolbar-btn.btn-disableAll:hover{background-color:#e53935}.btn-enableAll:before{height:0;border-style:solid;border-width:6px 0 6px 12px;border-color:transparent transparent transparent #fff}.btn-disableAll:before{width:12px;height:12px;background-color:#fff}.server-wrapper{position:relative;overflow:hidden;padding:1em 0}.server-header{margin-top:2em;border-bottom:2px #ffca28 solid;margin-bottom:.5em;position:relative;min-height:27px}.server-header:first-child{margin-top:0;flex:1}.server-heading{width:calc(100% - 100px)}.server-heading-prefix{position:absolute;top:-.7em;padding:.7em 1em .3em;margin-right:1em;color:#fff;text-shadow:0 -1px 1px rgba(0,0,0,.1)}.server-heading-prefix:before{content:'';position:absolute;background-color:#ffca28;transform:scaleY(.9) perspective(.8em) rotateX(5deg);transform-origin:left;top:0;right:0;left:0;bottom:0;z-index:-1;border-radius:.3em 0 0}.server-title{text-overflow:ellipsis;width:calc(100% - 120px);display:inline-block;overflow:hidden;margin-left:6.5em}.server-controll{width:100px;position:absolute;right:0;top:-10px;text-align:right}.server-controllBtn{margin-right:.5em;padding:.4em}.server-controllBtn.btn-enableAll:before{border-color:transparent transparent transparent #e0e0e0}.server-controllBtn.btn-disableAll:before{background-color:#e0e0e0}.server-controllBtn.btn-enableAll:hover:before{border-color:transparent transparent transparent #43a047}.server-controllBtn.btn-disableAll:hover:before{background-color:#e53935}.server-itemWrapper{display:flex;flex-flow:row wrap}.server-item{margin:.5em;min-width:calc(25% - 2px);border:1px solid #e0e0e0;padding:1em;flex:1}.server-item.is-enable{background:#58a;background:linear-gradient(-135deg,transparent 20px,#fff 0),linear-gradient(135deg,transparent 20px,#66bb6a 0);background-clip:padding-box}.server-item.is-disable{background:#58a;background:linear-gradient(-135deg,transparent 20px,#fff 0),linear-gradient(135deg,transparent 20px,#e57373 0);background-clip:padding-box}.server-item.is-editable .server-itemControll--edit{background-color:#1976d2}.server-item.is-editable .server-itemControll--edit:before{content:'Save'}.server-item.is-editable .server-itemControll--toggle{background-color:#e0e0e0}.server-info dt{color:#757575;font-size:.8em}.server-info dd{color:#212121;margin-bottom:1em;min-height:1.35em}.server-itemControll{display:flex;flex-flow:row wrap}.server-itemControll button{color:#fff;flex:1;padding:.3em 0;background-color:#e0e0e0;text-shadow:0 -1px 1px rgba(0,0,0,.2)}.is-enable .server-itemControll--toggle{background-color:#e57373;border-radius:3px 0 0 3px}.is-enable .server-itemControll--toggle:before{content:'Disable'}.is-enable .server-itemControll--toggle:hover{background-color:#e53935}.is-disable .server-itemControll--toggle{background-color:#66bb6a;border-radius:3px 0 0 3px}.is-disable .server-itemControll--toggle:before{content:'Enable'}.is-disable .server-itemControll--toggle:hover{background-color:#47a047}.server-itemControll--edit{background-color:#42a5f5;border-radius:0}.server-itemControll--edit:before{content:'Edit'}.server-itemControll--edit:hover{background-color:#1976d2}.server-itemControll--delete{background-color:#757575;border-radius:0 3px 3px 0}.server-itemControll--delete:hover{background-color:#212121}@media (max-width:700px){.container{position:relative;overflow-x:hidden;flex-direction:column;height:auto}.main{width:calc(100% - 2em);overflow:auto}.aside{width:100%;max-width:100%}.server-item{min-width:50%}.toolbar{display:flex}.toolbar-btn{flex:1;padding:.6em 0}.toolbar-btn:before{visibility:hidden}}@media (max-width:400px){.server-item{min-width:calc(100% - 3em)}}@media screen and (-webkit-min-device-pixel-ratio:0){.server-heading-prefix{padding:.8em 1em .35em}}
    </style>
  </head>

  <body>
    <div class="container">
      <aside class="aside">
        <fieldset class="add-wrapper">
          <legend class="add-title">Add new mapping</legend>
          <div class="add-row">
            <input id="name" type="text" class="add-field" />
            <label for="name">Server Name</label>
          </div>
          <div class="add-row">
            <input id="path" type="text" class="add-field" />
            <label for="path">Path</label>
          </div>
          <div class="add-row">
            <input id="upstream" type="text" class="add-field" />
            <label for="upstream">Upstream</label>
          </div>
          <div class="add-row">
            <textarea id="custom_tag" type="text" class="add-field"></textarea>
            <label for="custom_tag">Custom Tags</label>
          </div>
          <button type="submit" class="add-submit-btn">Add</button>
        </fieldset>
      </aside>
      <main class="main">
        <div class="toolbar">
          <button class="toolbar-btn btn-enableAll">Enable all</span></button>
          <button class="toolbar-btn btn-disableAll">Disable all</button>
        </div>
        <div class="server"></div>
      </main>
    </div>
  </body>

  <script>
    function sendRequest(e,t){function r(e){var t=[];for(var r in e)t.push(encodeURIComponent(r)+"="+encodeURIComponent(e[r]));return t.join("&")}var n=e.url,a=e.params?r(e.params):null;if(window.XMLHttpRequest)httpRequest=new XMLHttpRequest;else{if(!window.ActiveXObject)throw new Error("Your browser doesn't support Ajax!");httpRequest=new ActiveXObject("Microsoft.XMLHTTP")}httpRequest.open("POST",n,!0),a&&httpRequest.setRequestHeader("Content-type","application/x-www-form-urlencoded"),httpRequest.onreadystatechange=function(e){if(4===e.target.readyState){var r=e.target.status,n=e.target.responseText;t(r,n)}},httpRequest.send(a)}function parseData(e){for(var t in e)data[t]=e[t]}function renderPaths(e,t){var r=document.querySelectorAll(".server-itemWrapper"),n=r[r.length-1],a="";for(var s in e){var i=e[s],l=i.enabled?"is-enable":"is-disable",d=t+"-"+s+"-"+i.upstream;a+='<div class="server-item '+l+'" data-setting="'+d+'"><i class="server-status"></i><dl class="server-info"><dt>Path</dt><dd data-type="path">'+s+'</dd><dt>Upstream</dt><dd data-type="upstream">'+i.upstream+'</dd><dt>Custom Tags</dt><dd data-type="custom_tags">'+i.custom_tags+'</dd></dl><div class="server-itemControll"><button class="server-itemControll--toggle"></button><button class="server-itemControll--edit"></button><button class="server-itemControll--delete">Delete</button></div></div>'}n.insertAdjacentHTML("beforeend",a)}function renderServer(e){var t=document.querySelector(".server"),r='<div class="server-wrapper" data-name="'+e+'"><div class="server-header"><div class="server-heading"><span class="server-heading-prefix">Server</span><span class="server-title">'+e+'</span></div><div class="server-controll"><button class="server-controllBtn btn-enableAll"></button><button class="server-controllBtn btn-disableAll"></button></div></div><div class="server-itemWrapper"></div></div>';t.insertAdjacentHTML("beforeend",r)}function render(){clear();for(var e in data)Object.keys(data[e]).length&&(renderServer(e),renderPaths(data[e],e));bindActions()}function clear(){var e=document.querySelector(".server");e.innerHTML=""}function bindActions(){for(var e=document.querySelectorAll(".server-info > dd"),t=0;t<e.length;t++)e[t].addEventListener("keyup",function(e){var t=e.target.parentElement.parentElement.getAttribute("data-setting").split("-"),r=e.target.getAttribute("data-type");editSetting||(editSetting={},editSetting.name=t[0],editSetting.path=t[1],editSetting.new_path=t[1],editSetting.upstream=t[2],editSetting.new_upstream=t[2]),editSetting["new_"+r]=e.target.textContent});for(var r=document.querySelectorAll(".server-itemControll--edit"),t=0;t<r.length;t++)r[t].addEventListener("click",function(e){var t=e.target,r=t.parentElement.parentElement,n=r.classList.contains("is-editable"),a=r.querySelectorAll(".server-info > dd");if(n){r.classList.remove("is-editable");for(var s=a.length-1;s>=0;s--)a[s].setAttribute("contenteditable","false");editSetting&&sendRequest({url:"/api/modify",params:editSetting},function(e,t){if(200!==e)throw new Error("error",t);editSetting=null,parseData(JSON.parse(t)),render()})}else{r.classList.add("is-editable");for(var s=a.length-1;s>=0;s--)a[s].setAttribute("contenteditable","true")}});for(var n=document.querySelectorAll(".server-itemControll--delete"),t=0;t<n.length;t++)n[t].addEventListener("click",function(e){var t=e.target,r=t.parentElement.parentElement.getAttribute("data-setting").split("-"),n=r[0],a=r[1];sendRequest({url:"/api/delete",params:{name:n,path:a}},function(e,t){if(200!==e)throw new Error("error",t);var r=JSON.parse(t);0===Object.keys(r).length?delete data[n]:parseData(r),render()})});for(var a=document.querySelectorAll(".server-itemControll--toggle"),t=0;t<a.length;t++)a[t].addEventListener("click",function(e){var t=e.target,r=t.parentElement.parentElement,n=r.classList.contains("is-enable"),a=n?"/api/disable":"/api/enable",s=t.parentElement.parentElement.getAttribute("data-setting").split("-"),i={name:s[0],path:s[1]};sendRequest({url:a,params:i},function(e,t){if(200!==e)throw new Error("error",t);parseData(JSON.parse(t)),render()})});for(var s=document.querySelectorAll(".server-controllBtn"),t=s.length-1;t>=0;t--)s[t].addEventListener("click",function(e){var t=e.target,r=t.classList.contains("btn-enableAll"),n=t.parentElement.parentElement.parentElement.getAttribute("data-name"),a=r?"/api/enable":"/api/disable",s={url:a};n&&(s.params={name:n}),sendRequest(s,function(e,t){if(200!==e)throw new Error("error",t);parseData(JSON.parse(t)),render()})});for(var i=document.querySelectorAll(".add-field"),t=i.length-1;t>=0;t--)i[t].addEventListener("change",function(e){var t=e.target,r=t.getAttribute("id");addSetting||(addSetting={}),addSetting[r]=t.value});if(!init){for(var i=document.querySelectorAll(".add-field"),t=i.length-1;t>=0;t--)i[t].value="";for(var l=document.querySelectorAll(".toolbar-btn"),t=l.length-1;t>=0;t--)l[t].addEventListener("click",function(e){var t=e.target,r=t.classList.contains("btn-enableAll"),n=r?"/api/enable":"/api/disable";sendRequest({url:n},function(e,t){if(200!==e)throw new Error("error",t);parseData(JSON.parse(t)),render()})});var d=document.querySelector(".add-submit-btn"),o=document.querySelectorAll("label");d.addEventListener("click",function(){for(var e=o.length-1;e>=0;e--)o[e].removeAttribute("class");sendRequest({url:"/api/create",params:addSetting},function(e,t){if(200===e){for(var r=i.length-1;r>=0;r--)i[r].value="";addSetting=null,parseData(JSON.parse(t)),render()}else switch(e){case 409:o[0].classList.add("is-conflict"),o[1].classList.add("is-conflict");break;case 400:for(var r=o.length-2;r>=0;r--)o[r].classList.add("is-required");break;default:throw new Error("error",e,t)}})}),init=!0}}var httpRequest,data={},editSetting=null,addSetting=null,init=!1;sendRequest({url:"/api/list"},function(e,t){if(200!==e)throw new Error("error",t);parseData(JSON.parse(t)),render()});
  </script>
</html>
